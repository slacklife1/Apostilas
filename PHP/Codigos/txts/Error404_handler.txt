            File Information

            Verifying link...

            Register Your DAP

Please visit our sponsor

    //**************************************
    // for :Error404Handler.php
    //**************************************
    Copyright 2000 shaun@shat.net under the GNU Public License.
    //**************************************
    // Name: Error404Handler.php
    // Description:404 error handler. Don't wait for your visitors to report a broken link. Know about them as they happen by setting this script to be your ErrorDocument 404 in Apache. You'll receive an email report anytime someone encounters a 404 error on your site.
    // By: Shaun
    //
    //
    // Inputs:None
    //
    // Returns:Can generate email reports of errors
    //
    //Assumes:You will need to create or edit the .htaccess file in your document root, and add the following line:
    ErrorDocument 404 /path/to/404.php
    /path/to/404.php should be a path relative to your document root. Remember to upload both the 404.php script AND your .htaccess file in ASCII mode and chmod 755 them afterwards.
    //
    //Side Effects:None
    //This code is copyrighted and has limited warranties.
    //Please see http://www.Planet-Source-Code.com/xq/ASP/txtCodeId.275/lngWId.8/qx/vb/scripts/ShowCode.htm
    //for details.
    //**************************************
    
    <?
    # 404.php, 8/10/2000. Requires PHP3 or greater, this script 
    # has been written to function fully under PHP3.
    #
    # Traps 404 errors and mails a notice to the webmaster.
    # Copyright 2000 shaun@shat.net under the GNU Public License
    # Please email with questions or bug reports
    # Set these variables to configure the script:
    # Set $domain to your domain name (no www)
    $domain = "your.domain.com";
    # Set $docroot to the URL of the your document root (no slash).
    $docroot = "http://your.domain.com";
    # Font face you'd like to use on the 404 page
    $fontface = "Verdana";
    # Font size you'd like to use on the 404 page
    $fontsize = 2;
    # Background color of the 404 page (default is white)
    $bgcolor = "#ffffff";
    # Text color you'd like to use on the 404 page (default is black)
    $textcolor = "#000000";
    # This script is capable of mailing the details of each 404 error
    # to the webmaster. Use the $reportlevel variable to control when
    # you receive these reports.
    #
    # 0 = don't use the email capabilities
    # 1 = send email only if the error's referer contains your domain name
    #(i.e. the 404 was generated by a broken link on your site)
    # 2 = send email any time a 404 error is generated (useful for tracking
    #broken links at other sites which link to you)
    $reportlevel = 2;
    # Set $emailaddress to the email address of whoever should be
    # notified of 404 errors. Don't escape the @ symbol.
    # You can leave this unassigned if you're not using email features.
    $emailaddress = "you@your.domain.com";
    ################################################################
    # There is no need to edit below this line #
    ################################################################
    # The print_details function is what prints the 404 error to
    # the visitor. PHP3 doesn't incorporate Perl's print <<"EOT"
    # command, so you have to use a *lot* of echo statements...
    function print_details(){
    global $fontface, $fontsize, $docroot, $REQUEST_URI, $reportlevel;
    global $bgcolor, $textcolor
    # Print the 404 error in web format
    echo "<html><head><title>404 Not Found</title></head>";
    echo "<body bgcolor=\"$bgcolor\" text=\"$textcolor\">";
    echo "<b><h1>404 Not Found</h1></b>";
    echo "<p><font face=\"$fontface\" size=\"$fontsize\">";
    echo "We're sorry. The page you requested, $docroot$REQUEST_URI, doesn't exist";
    echo " on this server.</font></p>";
    # If an email report is being generated, let the visitor know:
    if ($reportlevel){
    echo "<p><font face=\"$fontface\" size=\"$fontsize\">";
    echo "The details of this error have automatically been mailed to the webmaster."; 
    }
    }
    # The send_email function sends the details of the 404 error to the
    # webmaster. 
    function send_email(){
    global $REQUEST_URI, $HTTP_REFERER, $emailaddress, $REMOTE_ADDR, $docroot;
    # Build the $errortime variable to contain the date/time of the error.
    $errortime = date("d/M/Y h:m:s")
    # Create the body of the email message
    $message .= "404 Error Report\n\nA 404 error was encountered by $REMOTE_ADDR";
    $message .= " on $errortime.\n\n";
    $message .= "The URI which generated the error is: \n$docroot$REQUEST_URI\n\n";
    $message .= "The referring page was:\n$HTTP_REFERER\n\n";
    # Send the mail message. This assumes mail() will work on your system!
    mail("$emailaddress", "404 Error Report", $message, "From: $emailaddress\n");
    }
    # Send a 404 error to the user's browser
    print_details();
    # See whether or not we should send an email report. If so, do it.
    if ($reportlevel != 0) 
    if ($reportlevel == 1) {
    if (eregi($domain,$HTTP_REFERER)) 
    send_email(); }
    else
    send_email();
    # All done!
    ?>
		

